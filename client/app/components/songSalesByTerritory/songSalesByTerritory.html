<div class="report-panel" ng-init="vm.initializeData()">
    <div class="panel panel-default reports">
        <div class="panel-heading {{$root.currentUser.role}}-heading clickable">
            <h3 class="panel-title">Song Sales Comparison By Territory/Territory Groups</h3>
            <span class="pull-right"><i class="glyphicon glyphicon-chevron-up"></i></span>
        </div>
        <div class="panel-body">
            <div class="container-fluid">
                <h4> Select Song or Song List:</h4>
            </div>
            <div class="container-fluid outerdiv">
                <select-song selected-song="vm.selectedSong"></select-song>
            </div>
            <div class="container-fluid">
                <h4 ng-if="vm.selectedSong" class="selectedSong {{$root.currentUser.role}}-heading">
                    Selected song: <span style="color: #F5B041">{{vm.selectedSong.trackname}}</span>
                </h4>
            </div>
            <div class="container-fluid">
                <div id="main-info" class="col-md-12 well report-criteria">
                    <div class="col-md-6 left-content">
                        <date-time-range range="vm.range"></date-time-range>
                        <div class="col-md-12 select">
                            <div class="select-label">Represent Territory Data As:</div>
                            <div class="represent">
                                <select ng-model="vm.territoryRepresentation">
                                    <option value="1">Individual Territories</option>
                                    <option value="2">Terrs/Terr Groups Exactly As Selected</option>
                                    <option value="3">Completely Aggregated</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 right-content">
                        <div class="territories">
                            <p>Select Territories/Territory Groups</p>
                            <multi-select-box item-groups="vm.territoryGroups" items="vm.territories" selected-item-groups="vm.selectedTerritoryGroups" selected-items="vm.selectedTerritories"></multi-select-box>
                        </div>
                        <div class="retailers ">
                            <p>Select Retailers</p>
                            <multi-select-box items="vm.retailers" selected-items="vm.selectedRetailers"></multi-select-box>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid error-alert ">
                <div ng-if="vm.songError ">
                    {{vm.songError}}
                </div>
                <div ng-if="vm.rangeError ">
                    {{vm.rangeError}}
                </div>
                <div ng-if="vm.timeError ">
                    {{vm.timeError}}
                </div>
                <div ng-if="vm.terrError ">
                    {{vm.terrError}}
                </div>
            </div>
            <div class="container-fluid ">
                <button id="confirmSubmit " type="submit " class="btn btn-success " ng-click="vm.getChart() ">Get Information</button>
            </div>
        </div>
    </div>
    <div style="color: red; ">
        {{vm.NoChartError}}
    </div>
    <div class="loader" ng-if="vm.loading"></div>
    <div ng-if="!vm.loading" class="chart-container">
        <div class="container-fluid" ng-if="!vm.theChart && vm.chart" style="padding-top:25px">
            <c3chart bindto-id="chartGroupDataPoints" chart-data="vm.datapoints" chart-columns="vm.datacolumns" chart-x="vm.datax" enable-zoom="true" show-subchart="true" callback-function="vm.handleCallback1" empty-label="No data available for above selections">
                <chart-size chart-height="650" />
                <chart-tooltip show-tooltip="true" name-format-function="vm.formatTooltip" />
                <!-- <chart-bar ratio="0.5" /> -->
                <chart-axes values-x="x" />
                <chart-axis>
                    <chart-axis-x axis-position="outer-center" axis-type="category" />
                    <chart-axis-y axis-position="outer-middle" axis-label="Sales" axis-type="category" />
                    <chart-axis-x-tick tick-rotate="0" tick-multiline="false" />
                </chart-axis>
                <chart-legend legend-position="inset" />
            </c3chart>
        </div>
        <div class="container-fluid" ng-if="vm.theChart" style="padding-top:25px">
            <div class="container-fluid">
                <div class="col-md-12 graph-type-labels">
                    <a class="btn btn-primary" ng-class="{'active': chartType.isActive}" ng-repeat="chartType in vm.chartTypes" ng-click="vm.changeChartType(chartType)">{{chartType.name}}</a>
                </div>
            </div>
            <div class="graph-song-label">{{vm.selectedSong.trackname}}</div>
            <div class="container-fluid" ng-if="!vm.theChart && vm.chart && !vm.showHeatMap" style="padding-top:25px">
                <c3chart bindto-id="chartGroupDataPoints" chart-data="vm.datapoints" chart-columns="vm.datacolumns" chart-x="vm.datax" enable-zoom="true" show-subchart="true" callback-function="vm.handleCallback1" empty-label="No data available for above selections"
                    ng-if="!vm.showHeatMap">
                    <chart-size chart-height="700" />
                    <chart-tooltip show-tooltip="true" />
                    <!-- <chart-bar ratio="0.5" /> -->
                    <chart-axes values-x="x" />
                    <chart-axis>
                        <chart-axis-x axis-position="outer-center" axis-label="Aggreagate" axis-type="category" />
                        <chart-axis-y axis-position="outer-middle" axis-label="Sales" axis-type="category" />
                        <chart-axis-x-tick tick-rotate="0" tick-multiline="false" />
                    </chart-axis>
                    <chart-legend legend-position="inset" />
                    <chart-events on-click-data="vm.showRetailerBreakOut(data)" />
                </c3chart>
            </div>
            <div class="container-fluid" ng-show="vm.theChart && !vm.showHeatMap" style="padding-top:25px">
                <c3chart bindto-id="chartGroupDataPoints" chart-data="vm.datapoints" chart-columns="vm.datacolumns" chart-x="vm.datax" enable-zoom="true" show-subchart="true" callback-function="vm.handleCallback2" empty-label="No data available for above selections">
                    <chart-tooltip show-tooltip="true" />
                    <chart-size chart-height="700" />
                    <!-- <chart-bar ratio="0.5" /> -->
                    <chart-axes values-x="x" />
                    <chart-axis>
                        <chart-axis-x axis-position="outer-center" axis-type="category" />
                        <chart-axis-y axis-position="outer-middle" axis-label="Sales" axis-type="category" />
                        <chart-axis-x-tick tick-rotate="45" tick-multiline="false" />
                    </chart-axis>
                    <chart-legend legend-position="inset" />
                    <chart-events on-click-data="vm.showRetailerBreakOut(data)" />
                </c3chart>
            </div>
            <div class="container-fluid" id="world-map" ng-if="vm.showHeatMap">
                <div datamap data="vm.heatMapData" id="world-map-container" show-heat-map="vm.showHeatMap" ng-if="!vm.showNoData"> </div>
                <div ng-if="vm.showNoData" class="no-map-data">No data available for heatmap for the selected Date Range</div>
            </div>
        </div>
    </div>
    <div ng-if="vm.chart && vm.drilldown">
        <div class="container drilldown">
            <h3 class="tab-head">Sales</h3>
            <h4>{{vm.selectedSong.trackname}}</h4>
            <div class="col-xs-12">
                <table st-table class="table table-hover table-responsive">
                    <tbody ng-init="showTer={};showDate={};showRet={};">
                        <tr ng-repeat-start="geography in vm.chart.salesByGeography">
                            <td ng-click="geography.totalGeographySales > 0 ?(showTer[geography.geographyName] = !showTer[geography.geographyName]): null">
                                <i style="padding-left: 18px; " ng-if="geography.totalGeographySales == 0"></i>
                                <i class="glyphicon" ng-if="geography.totalGeographySales>0" ng-class=" showTer[geography.geographyName] ? 'glyphicon-chevron-down' : 'glyphicon-chevron-right'"></i> {{geography.geographyName}}
                            </td>
                            <td class="text-right"><strong>{{geography.totalGeographySales}}</strong></td>
                        </tr>
                        <tr ng-repeat-start="day in geography.salesByDate" ng-show="showTer[geography.geographyName]">
                            <td ng-click="day.totalDaySales?showDate[geography.geographyName][day.date] = !showDate[geography.geographyName][day.date]:null" ng-if="day.totalDaySales>0">
                                <i style="padding-left: 20px"></i>
                                <i style="padding-left:18px" ng-if="day.totalDaySales==0"></i>
                                <i class="glyphicon" ng-if="day.totalDaySales>0" ng-class=" showDate[geography.geographyName][day.date] ? 'glyphicon-chevron-down' : 'glyphicon-chevron-right'"></i> {{day.date}}
                            </td>
                            <td class="text-right" ng-if="day.totalDaySales>0">
                                <strong>{{day.totalDaySales}}</strong>
                            </td>
                        </tr>
                        <tr ng-repeat-start="retailer in day.salesByRetailer" ng-show="showTer[geography.geographyName] && showDate[geography.geographyName][day.date]">
                            <td ng-click="retailer.totalRetailerSales?showRet[geography.geographyName][day.date][retailer.retailerName] = !showRet[geography.geographyName][day.date][retailer.retailerName]:null" ng-if="retailer.totalRetailerSales>0">
                                <i style="padding-left: 40px"></i>
                                <i style="padding-left:18px" ng-if="retailer.totalRetailerSales==0"></i>
                                <i class="glyphicon" ng-if="retailer.totalRetailerSales>0" ng-class=" showRet[geography.geographyName][day.date][retailer.retailerName] ? 'glyphicon-chevron-down' : 'glyphicon-chevron-right'"></i> {{retailer.retailerName}}
                            </td>
                            <td class="text-right" ng-if="retailer.totalRetailerSales>0">
                                <strong>{{retailer.totalRetailerSales}}</strong>
                            </td>
                        </tr>
                        <tr ng-repeat-start="time in retailer.salesByTime" ng-show="showTer[geography.geographyName] && showDate[geography.geographyName][day.date] && showRet[geography.geographyName][day.date][retailer.retailerName]">
                            <td>
                                <i style="padding-left: 80px"></i> {{vm.getTimeRangeInFormat(time.timeRange)}}
                            </td>
                            <td class="text-right" ng-if="time.totalSales>0">
                                <strong>{{time.totalSales}}</strong>
                            </td>
                        </tr>
                        <tr ng-repeat-end></tr>
                        <tr ng-repeat-end></tr>
                        <tr ng-repeat-end></tr>
                        <tr ng-repeat-end></tr>
                        <tr class="tab-head">
                            <td><strong>Total Sales</strong></td>
                            <td class="text-right"><strong>{{vm.chart.totalSongSales}}</strong></td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr>
                            <td style="border-top: none;"><a class="btn btn-default" st-export>Export to Excel</a></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>
</div>